---
title: "Process"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Process}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Example 1: Daymet GDD

### Project

The following example shows how to project the CDL cropmaps, using the tmin Daymet variable as a template.

```{r, eval = FALSE}
 x <- new("Cropmaps", region = region, date = date, dir = dir)
 y <- new("Daymet", region = region, date = date, dir = dir)
 project(x, y, "cdl", "tmin", "cdl_default")
```

### Recode and Summarize

The following example shows how to recode and summarize the CDL cropmaps.

```{r, eval = FALSE}
 x <- new("Cropmaps", region = region, date = date, dir = dir)
 recode(x, "cdl_default", mdname = "default")
 mydf <- summarize(x, "cdl_default")
```

### Derive

The following example shows how to derive the GDD Daymet variable using the labels of the CDL cropmaps.

```{r, eval = FALSE}
 x <- new("Daymet", region = region, date = date, dir = dir)
 y <- new("Cropmaps", region = region, date = date, dir = dir)
 z <- new("Parameters", region = region, date = date, dir = dir)
 tb_ct <- read_metadata(z, "default")$tb_ct
 derive(x, y, "gdd", varxy = c("tmin", "tmax", "cdl_default"), tb_ct = tb_ct)
 plot(x, "gdd", "2002-08-01")
```

### Compose

The following example shows how to compose the GDD variable of the Daymet product, using the CDL variable of the Cropmaps product to group the crops of interest.

```{r, eval = FALSE}
 x <- new("Daymet", region = region, date = date, dir = dir)
 y <- new("Cropmaps", region = region, date = date, dir = dir)
 a <- compose(x, y, variablex = "gdd", variabley = "cdl_default", fun = "mean")
```

## Example 2: MOD09GA NDVI

### Derive

The following example shows how to derive the GDD Daymet variable using the labels of the CDL cropmaps.

```{r, eval = FALSE}
 x <- new("Daymet", region = region, date = date, dir = dir)
 y <- new("Cropmaps", region = region, date = date, dir = dir)
 z <- new("Parameters", region = region, date = date, dir = dir)
 tb_ct <- read_metadata(z, "default")$tb_ct
 derive(x, y, "gdd", varxy = c("tmin", "tmax", "cdl_default"), tb_ct = tb_ct)
 plot(x, "gdd", "2002-08-01")
```

The following example shows how to derive the NDVI and cloudmask variables of the MOD09GA product.

```{r, eval = FALSE}
 x <- new("Mod09ga", region = region, date = date, dir = dir)
 derive(x, "ndvi")
 derive(x, "cloudmask")
```

The `fillgaps()` function can be used to create empty (NA) rasters for the dates that the product is missing.

```{r, eval = FALSE}
 x <- new("Mod09ga", region = region, date = date, dir = dir)
 fillgaps(x, "ndvi")
 fillgaps(x, "cloudmask")
```

The `mask()` function can be used to mask one variable based on another.

```{r, eval = FALSE}
 x <- new("Mod09ga", region = region, date = date, dir = dir)
 mask(x, "ndvi", "cloudmask")
```

### Smooth

The following example shows how to smooth the NDVI variable of the MOD09GA product, using the 1st order whittaker smoother.

```{r, eval = FALSE}
 x <- new("Mod09ga", region = region, date = date, dir = dir)
 pre <- NULL
 post <- NULL
 smoothout(x, "ndvi", pre = pre, post = post)
```

### Compose

The following example shows how to compose the smoothed NDVI variable of the MOD09GA product, using the CDL variable of the Cropmaps product to group the crops of interest.

```{r, eval = FALSE}
 x <- new("Mod09ga", region = region, date = date, dir = dir)
 y <- new("Cropmaps", region = region, date = date, dir = dir)
 b <- compose(x, y, variablex = "ndvi_smooth_wt1", variabley = "cdl_default", fun = "mean")
```
